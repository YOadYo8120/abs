import{d as Z,m as v,q as P,s as W,r as h,y as ee,i,a,e as t,h as te,w as l,b as d,j as O,f as s,o,F as x,k as w,t as r,c as q}from"./app-iB5JroHL.js";import{_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-BjDdRGsn.js";import{_ as b}from"./index-X0dx6blS.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-RTZaJV3S.js";import{_ as A,a as z,b as N,c as F,d as m}from"./SelectValue.vue_vue_type_script_setup_true_lang-DO0Su85m.js";import{_ as le,a as ne,b as D,c as M,d as se,e as j}from"./TableHeader.vue_vue_type_script_setup_true_lang-Di5BFEE9.js";import{_ as ue}from"./index-Dqcqe94q.js";import"./index-DDOeCoQC.js";import"./VisuallyHidden-CsxWP5mD.js";import"./useForwardExpose-DlFM9lJQ.js";import"./useForwardPropsEmits-CnK8L7VS.js";import"./users-C3V69xlN.js";import"./check-nENIt2ia.js";import"./useFormControl-D6S8Nnlo.js";const de={class:"p-6 space-y-6"},oe={class:"bg-card p-6 rounded-lg shadow border space-y-4"},re={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},ie={key:0},fe={key:1},ve={key:0},me={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-2"},ce={class:"font-semibold"},_e={class:"text-xs opacity-75"},pe={key:1,class:"text-center py-4 text-muted-foreground"},ye={key:0,class:"bg-card p-6 rounded-lg shadow border"},ke={class:"flex justify-between items-center mb-4"},Se={class:"text-xl font-semibold"},be={class:"space-x-2"},ge={class:"flex gap-2"},Ue=Z({__name:"Index",setup($e){const c=v(1),T=v(1),_=v(""),p=v(""),E=v(1),f=v(null),y=v([]),k=v([]),G=v({}),U=v(!1),L=["GI","GC","GE","GM"],J=["DEV","AI"],Y={monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday"},K=P(()=>c.value>=3),B=P(()=>c.value>=4&&_.value==="GI");W(c,u=>{u<3&&(_.value="",p.value=""),u<4&&(p.value=""),f.value=null,y.value=[],k.value=[],C()}),W(_,u=>{u!=="GI"&&(p.value=""),f.value=null,y.value=[],k.value=[]});const C=async()=>{if(!(!c.value||!T.value||!E.value)&&!(c.value>=3&&!_.value)&&!(B.value&&!p.value))try{const e=await(await fetch(`/teacher/attendance/schedules?year=${c.value}&semester=${T.value}&week_number=${E.value}&specialization=${_.value}&track=${p.value}`)).json();y.value=e,y.value.length>0&&!f.value&&I(y.value[0])}catch(u){console.error("Failed to load schedules:",u)}},I=u=>{f.value=u,R(u.id)},R=async u=>{U.value=!0;try{h.get("/teacher/attendance",{schedule_id:u},{preserveScroll:!0,onSuccess:e=>{k.value=e.props.students,G.value=e.props.attendances}})}catch(e){console.error("Failed to load attendance:",e)}finally{U.value=!1}},g=async(u,e)=>{if(f.value)try{const S=await(await fetch("/teacher/attendance",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({schedule_id:f.value.id,student_id:u,status:e})})).json();S.success&&(G.value[u]=S.attendance)}catch(n){console.error("Failed to update attendance:",n),alert("Failed to update attendance")}},$=u=>G.value[u]?.status||"absent",X=u=>{switch(u){case"present":return"default";case"absent":return"destructive";case"late":return"secondary";case"excused":return"outline";default:return"outline"}},H=()=>{k.value.forEach(u=>{g(u.id,"present")})},Q=()=>{k.value.forEach(u=>{g(u.id,"absent")})};return ee(()=>{C()}),(u,e)=>(o(),i(x,null,[a(t(te),{title:"Attendance Management"}),a(ae,null,{default:l(()=>[d("div",de,[e[28]||(e[28]=d("div",{class:"flex justify-between items-center"},[d("h1",{class:"text-2xl font-bold"},"Attendance Management")],-1)),d("div",oe,[d("div",re,[d("div",null,[a(t(V),null,{default:l(()=>[...e[5]||(e[5]=[s("Year",-1)])]),_:1}),a(t(A),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=n=>c.value=n)},{default:l(()=>[a(t(z),null,{default:l(()=>[a(t(N),{placeholder:"Select year"})]),_:1}),a(t(F),null,{default:l(()=>[a(t(m),{value:1},{default:l(()=>[...e[6]||(e[6]=[s("1st Year",-1)])]),_:1}),a(t(m),{value:2},{default:l(()=>[...e[7]||(e[7]=[s("2nd Year",-1)])]),_:1}),a(t(m),{value:3},{default:l(()=>[...e[8]||(e[8]=[s("3rd Year",-1)])]),_:1}),a(t(m),{value:4},{default:l(()=>[...e[9]||(e[9]=[s("4th Year",-1)])]),_:1}),a(t(m),{value:5},{default:l(()=>[...e[10]||(e[10]=[s("5th Year",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),d("div",null,[a(t(V),null,{default:l(()=>[...e[11]||(e[11]=[s("Semester",-1)])]),_:1}),a(t(A),{modelValue:T.value,"onUpdate:modelValue":[e[1]||(e[1]=n=>T.value=n),C]},{default:l(()=>[a(t(z),null,{default:l(()=>[a(t(N),{placeholder:"Select semester"})]),_:1}),a(t(F),null,{default:l(()=>[a(t(m),{value:1},{default:l(()=>[...e[12]||(e[12]=[s("Semester 1",-1)])]),_:1}),a(t(m),{value:2},{default:l(()=>[...e[13]||(e[13]=[s("Semester 2",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),K.value?(o(),i("div",ie,[a(t(V),null,{default:l(()=>[...e[14]||(e[14]=[s("Specialization",-1)])]),_:1}),a(t(A),{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=n=>_.value=n)},{default:l(()=>[a(t(z),null,{default:l(()=>[a(t(N),{placeholder:"Select specialization"})]),_:1}),a(t(F),null,{default:l(()=>[(o(),i(x,null,w(L,n=>a(t(m),{key:n,value:n},{default:l(()=>[s(r(n),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])):O("",!0),B.value?(o(),i("div",fe,[a(t(V),null,{default:l(()=>[...e[15]||(e[15]=[s("Track",-1)])]),_:1}),a(t(A),{modelValue:p.value,"onUpdate:modelValue":[e[3]||(e[3]=n=>p.value=n),C]},{default:l(()=>[a(t(z),null,{default:l(()=>[a(t(N),{placeholder:"Select track"})]),_:1}),a(t(F),null,{default:l(()=>[(o(),i(x,null,w(J,n=>a(t(m),{key:n,value:n},{default:l(()=>[s(r(n),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])):O("",!0),d("div",null,[a(t(V),null,{default:l(()=>[...e[16]||(e[16]=[s("Week",-1)])]),_:1}),a(t(A),{modelValue:E.value,"onUpdate:modelValue":[e[4]||(e[4]=n=>E.value=n),C]},{default:l(()=>[a(t(z),null,{default:l(()=>[a(t(N),{placeholder:"Select week"})]),_:1}),a(t(F),null,{default:l(()=>[(o(),i(x,null,w(20,n=>a(t(m),{key:n,value:n},{default:l(()=>[s(" Week "+r(n),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])]),y.value.length>0?(o(),i("div",ve,[a(t(V),null,{default:l(()=>[...e[17]||(e[17]=[s("Select Session",-1)])]),_:1}),d("div",me,[(o(!0),i(x,null,w(y.value,n=>(o(),q(t(b),{key:n.id,variant:f.value?.id===n.id?"default":"outline",onClick:S=>I(n),class:"text-left flex flex-col items-start h-auto py-3"},{default:l(()=>[d("div",ce,r(n.module.name),1),d("div",_e,r(Y[n.day])+" - "+r(n.start_time)+" to "+r(n.end_time),1)]),_:2},1032,["variant","onClick"]))),128))])])):(o(),i("div",pe," No sessions found for the selected filters. "))]),f.value&&k.value.length>0?(o(),i("div",ye,[d("div",ke,[d("h2",Se,r(f.value.module.name)+" - "+r(Y[f.value.day]),1),d("div",be,[a(t(b),{onClick:H,variant:"outline",size:"sm"},{default:l(()=>[...e[18]||(e[18]=[s(" Mark All Present ",-1)])]),_:1}),a(t(b),{onClick:Q,variant:"outline",size:"sm"},{default:l(()=>[...e[19]||(e[19]=[s(" Mark All Absent ",-1)])]),_:1})])]),a(t(le),null,{default:l(()=>[a(t(ne),null,{default:l(()=>[a(t(D),null,{default:l(()=>[a(t(M),null,{default:l(()=>[...e[20]||(e[20]=[s("Student Code",-1)])]),_:1}),a(t(M),null,{default:l(()=>[...e[21]||(e[21]=[s("Name",-1)])]),_:1}),a(t(M),null,{default:l(()=>[...e[22]||(e[22]=[s("Status",-1)])]),_:1}),a(t(M),null,{default:l(()=>[...e[23]||(e[23]=[s("Actions",-1)])]),_:1})]),_:1})]),_:1}),a(t(se),null,{default:l(()=>[(o(!0),i(x,null,w(k.value,n=>(o(),q(t(D),{key:n.id},{default:l(()=>[a(t(j),null,{default:l(()=>[s(r(n.code),1)]),_:2},1024),a(t(j),null,{default:l(()=>[s(r(n.first_name)+" "+r(n.last_name),1)]),_:2},1024),a(t(j),null,{default:l(()=>[a(t(ue),{variant:X($(n.id))},{default:l(()=>[s(r($(n.id)),1)]),_:2},1032,["variant"])]),_:2},1024),a(t(j),null,{default:l(()=>[d("div",ge,[a(t(b),{onClick:S=>g(n.id,"present"),size:"sm",variant:$(n.id)==="present"?"default":"outline"},{default:l(()=>[...e[24]||(e[24]=[s(" Present ",-1)])]),_:1},8,["onClick","variant"]),a(t(b),{onClick:S=>g(n.id,"absent"),size:"sm",variant:$(n.id)==="absent"?"destructive":"outline"},{default:l(()=>[...e[25]||(e[25]=[s(" Absent ",-1)])]),_:1},8,["onClick","variant"]),a(t(b),{onClick:S=>g(n.id,"late"),size:"sm",variant:$(n.id)==="late"?"secondary":"outline"},{default:l(()=>[...e[26]||(e[26]=[s(" Late ",-1)])]),_:1},8,["onClick","variant"]),a(t(b),{onClick:S=>g(n.id,"excused"),size:"sm",variant:$(n.id)==="excused"?"default":"outline"},{default:l(()=>[...e[27]||(e[27]=[s(" Excused ",-1)])]),_:1},8,["onClick","variant"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):O("",!0)])]),_:1})],64))}});export{Ue as default};
