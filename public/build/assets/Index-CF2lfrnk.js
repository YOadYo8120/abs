import{d as Q,m as f,q as I,y as Z,i,a,e as t,h,w as l,b as o,j as G,f as s,o as d,F as g,k as C,t as r,c as W,r as ee}from"./app-CQScspJV.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-H8USLuKZ.js";import{_ as p}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CWTvO1CT.js";import{_ as $}from"./Label.vue_vue_type_script_setup_true_lang-J_y2c9_X.js";import{_ as w,a as A,b as z,c as N,d as m}from"./SelectValue.vue_vue_type_script_setup_true_lang--ddNUqrt.js";import{_ as ae,a as le,b as q,c as M,d as ne,e as j}from"./TableHeader.vue_vue_type_script_setup_true_lang-CToyBq9O.js";import{_ as se}from"./index-CyvA0Ved.js";import"./index-3yuum4Sn.js";import"./VisuallyHidden-gVgl18LK.js";import"./useForwardExpose-Vv3P2laI.js";import"./useForwardPropsEmits-DnKx72kq.js";import"./index-C4J_hXM0.js";import"./createLucideIcon-DNvKDgj3.js";import"./check-B6qghZgb.js";import"./useFormControl-DCuIHI-Z.js";const ue={class:"p-6 space-y-6"},oe={class:"bg-white p-6 rounded-lg shadow space-y-4"},de={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},re={key:0},ie={key:1},fe={key:0},me={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-2"},ve={class:"font-semibold"},ce={class:"text-xs opacity-75"},_e={key:1,class:"text-center py-4 text-gray-500"},pe={key:0,class:"bg-white p-6 rounded-lg shadow"},ye={class:"flex justify-between items-center mb-4"},ke={class:"text-xl font-semibold"},Se={class:"space-x-2"},ge={class:"flex gap-2"},Oe=Q({__name:"Index",setup($e){const c=f(1),F=f(1),b=f(""),T=f(""),E=f(1),v=f(null),x=f([]),V=f([]),Y=f({}),O=f(!1),D=["GI","GC","GE","GM"],L=["DEV","AI"],U={monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday"},J=I(()=>c.value>=3),B=I(()=>c.value>=4&&b.value==="GI"),y=async()=>{if(!(!c.value||!F.value||!E.value)&&!(c.value>=3&&!b.value)&&!(B.value&&!T.value))try{const e=await(await fetch(`/teacher/attendance/schedules?year=${c.value}&semester=${F.value}&week_number=${E.value}&specialization=${b.value}&track=${T.value}`)).json();x.value=e,x.value.length>0&&!v.value&&P(x.value[0])}catch(u){console.error("Failed to load schedules:",u)}},P=u=>{v.value=u,K(u.id)},K=async u=>{O.value=!0;try{ee.get("/teacher/attendance",{schedule_id:u},{preserveScroll:!0,onSuccess:e=>{V.value=e.props.students,Y.value=e.props.attendances}})}catch(e){console.error("Failed to load attendance:",e)}finally{O.value=!1}},k=async(u,e)=>{if(v.value)try{const _=await(await fetch("/teacher/attendance",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({schedule_id:v.value.id,student_id:u,status:e})})).json();_.success&&(Y.value[u]=_.attendance)}catch(n){console.error("Failed to update attendance:",n),alert("Failed to update attendance")}},S=u=>Y.value[u]?.status||"absent",R=u=>{switch(u){case"present":return"default";case"absent":return"destructive";case"late":return"secondary";case"excused":return"outline";default:return"outline"}},X=()=>{V.value.forEach(u=>{k(u.id,"present")})},H=()=>{V.value.forEach(u=>{k(u.id,"absent")})};return Z(()=>{y()}),(u,e)=>(d(),i(g,null,[a(t(h),{title:"Attendance Management"}),a(te,null,{default:l(()=>[o("div",ue,[e[28]||(e[28]=o("div",{class:"flex justify-between items-center"},[o("h1",{class:"text-2xl font-bold"},"Attendance Management")],-1)),o("div",oe,[o("div",de,[o("div",null,[a(t($),null,{default:l(()=>[...e[5]||(e[5]=[s("Year",-1)])]),_:1}),a(t(w),{modelValue:c.value,"onUpdate:modelValue":[e[0]||(e[0]=n=>c.value=n),y]},{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(z),{placeholder:"Select year"})]),_:1}),a(t(N),null,{default:l(()=>[a(t(m),{value:1},{default:l(()=>[...e[6]||(e[6]=[s("1st Year",-1)])]),_:1}),a(t(m),{value:2},{default:l(()=>[...e[7]||(e[7]=[s("2nd Year",-1)])]),_:1}),a(t(m),{value:3},{default:l(()=>[...e[8]||(e[8]=[s("3rd Year",-1)])]),_:1}),a(t(m),{value:4},{default:l(()=>[...e[9]||(e[9]=[s("4th Year",-1)])]),_:1}),a(t(m),{value:5},{default:l(()=>[...e[10]||(e[10]=[s("5th Year",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o("div",null,[a(t($),null,{default:l(()=>[...e[11]||(e[11]=[s("Semester",-1)])]),_:1}),a(t(w),{modelValue:F.value,"onUpdate:modelValue":[e[1]||(e[1]=n=>F.value=n),y]},{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(z),{placeholder:"Select semester"})]),_:1}),a(t(N),null,{default:l(()=>[a(t(m),{value:1},{default:l(()=>[...e[12]||(e[12]=[s("Semester 1",-1)])]),_:1}),a(t(m),{value:2},{default:l(()=>[...e[13]||(e[13]=[s("Semester 2",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),J.value?(d(),i("div",re,[a(t($),null,{default:l(()=>[...e[14]||(e[14]=[s("Specialization",-1)])]),_:1}),a(t(w),{modelValue:b.value,"onUpdate:modelValue":[e[2]||(e[2]=n=>b.value=n),y]},{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(z),{placeholder:"Select specialization"})]),_:1}),a(t(N),null,{default:l(()=>[(d(),i(g,null,C(D,n=>a(t(m),{key:n,value:n},{default:l(()=>[s(r(n),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])):G("",!0),B.value?(d(),i("div",ie,[a(t($),null,{default:l(()=>[...e[15]||(e[15]=[s("Track",-1)])]),_:1}),a(t(w),{modelValue:T.value,"onUpdate:modelValue":[e[3]||(e[3]=n=>T.value=n),y]},{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(z),{placeholder:"Select track"})]),_:1}),a(t(N),null,{default:l(()=>[(d(),i(g,null,C(L,n=>a(t(m),{key:n,value:n},{default:l(()=>[s(r(n),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])):G("",!0),o("div",null,[a(t($),null,{default:l(()=>[...e[16]||(e[16]=[s("Week",-1)])]),_:1}),a(t(w),{modelValue:E.value,"onUpdate:modelValue":[e[4]||(e[4]=n=>E.value=n),y]},{default:l(()=>[a(t(A),null,{default:l(()=>[a(t(z),{placeholder:"Select week"})]),_:1}),a(t(N),null,{default:l(()=>[(d(),i(g,null,C(20,n=>a(t(m),{key:n,value:n},{default:l(()=>[s(" Week "+r(n),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["modelValue"])])]),x.value.length>0?(d(),i("div",fe,[a(t($),null,{default:l(()=>[...e[17]||(e[17]=[s("Select Session",-1)])]),_:1}),o("div",me,[(d(!0),i(g,null,C(x.value,n=>(d(),W(t(p),{key:n.id,variant:v.value?.id===n.id?"default":"outline",onClick:_=>P(n),class:"text-left flex flex-col items-start h-auto py-3"},{default:l(()=>[o("div",ve,r(n.module.name),1),o("div",ce,r(U[n.day])+" - "+r(n.start_time)+" to "+r(n.end_time),1)]),_:2},1032,["variant","onClick"]))),128))])])):(d(),i("div",_e," No sessions found for the selected filters. "))]),v.value&&V.value.length>0?(d(),i("div",pe,[o("div",ye,[o("h2",ke,r(v.value.module.name)+" - "+r(U[v.value.day]),1),o("div",Se,[a(t(p),{onClick:X,variant:"outline",size:"sm"},{default:l(()=>[...e[18]||(e[18]=[s(" Mark All Present ",-1)])]),_:1}),a(t(p),{onClick:H,variant:"outline",size:"sm"},{default:l(()=>[...e[19]||(e[19]=[s(" Mark All Absent ",-1)])]),_:1})])]),a(t(ae),null,{default:l(()=>[a(t(le),null,{default:l(()=>[a(t(q),null,{default:l(()=>[a(t(M),null,{default:l(()=>[...e[20]||(e[20]=[s("Student Code",-1)])]),_:1}),a(t(M),null,{default:l(()=>[...e[21]||(e[21]=[s("Name",-1)])]),_:1}),a(t(M),null,{default:l(()=>[...e[22]||(e[22]=[s("Status",-1)])]),_:1}),a(t(M),null,{default:l(()=>[...e[23]||(e[23]=[s("Actions",-1)])]),_:1})]),_:1})]),_:1}),a(t(ne),null,{default:l(()=>[(d(!0),i(g,null,C(V.value,n=>(d(),W(t(q),{key:n.id},{default:l(()=>[a(t(j),null,{default:l(()=>[s(r(n.code),1)]),_:2},1024),a(t(j),null,{default:l(()=>[s(r(n.first_name)+" "+r(n.last_name),1)]),_:2},1024),a(t(j),null,{default:l(()=>[a(t(se),{variant:R(S(n.id))},{default:l(()=>[s(r(S(n.id)),1)]),_:2},1032,["variant"])]),_:2},1024),a(t(j),null,{default:l(()=>[o("div",ge,[a(t(p),{onClick:_=>k(n.id,"present"),size:"sm",variant:S(n.id)==="present"?"default":"outline"},{default:l(()=>[...e[24]||(e[24]=[s(" Present ",-1)])]),_:1},8,["onClick","variant"]),a(t(p),{onClick:_=>k(n.id,"absent"),size:"sm",variant:S(n.id)==="absent"?"destructive":"outline"},{default:l(()=>[...e[25]||(e[25]=[s(" Absent ",-1)])]),_:1},8,["onClick","variant"]),a(t(p),{onClick:_=>k(n.id,"late"),size:"sm",variant:S(n.id)==="late"?"secondary":"outline"},{default:l(()=>[...e[26]||(e[26]=[s(" Late ",-1)])]),_:1},8,["onClick","variant"]),a(t(p),{onClick:_=>k(n.id,"excused"),size:"sm",variant:S(n.id)==="excused"?"default":"outline"},{default:l(()=>[...e[27]||(e[27]=[s(" Excused ",-1)])]),_:1},8,["onClick","variant"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):G("",!0)])]),_:1})],64))}});export{Oe as default};
