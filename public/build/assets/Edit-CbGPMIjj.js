import{d as M,m as h,q as C,c as j,w as o,b as t,a as i,e as s,f as c,t as d,i as f,j as y,o as r,n as b,F as $,k as D,r as F}from"./app-iB5JroHL.js";import{X as E,_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-BjDdRGsn.js";import{_ as J,a as q,b as A,c as S}from"./CardTitle.vue_vue_type_script_setup_true_lang-BOdCY70B.js";import{_ as T}from"./CardDescription.vue_vue_type_script_setup_true_lang-DOygd7NC.js";import{_ as k}from"./Label.vue_vue_type_script_setup_true_lang-RTZaJV3S.js";import{_ as I}from"./Textarea.vue_vue_type_script_setup_true_lang-C-mz5mvU.js";import{c as K,_}from"./index-X0dx6blS.js";import{_ as L}from"./Input.vue_vue_type_script_setup_true_lang-CcVhxJql.js";import{_ as O}from"./index-Dqcqe94q.js";import{C as H}from"./circle-alert-BXdPTOmv.js";import{F as R}from"./file-up-C7mvjoQ2.js";import"./index-DDOeCoQC.js";import"./VisuallyHidden-CsxWP5mD.js";import"./useForwardExpose-DlFM9lJQ.js";import"./useForwardPropsEmits-CnK8L7VS.js";import"./users-C3V69xlN.js";const X=K("FileIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),Y={class:"py-12"},Z={class:"max-w-4xl mx-auto sm:px-6 lg:px-8 space-y-6"},Q={class:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3"},W={class:"flex-1"},ee={key:0,class:"text-sm text-red-800 whitespace-pre-wrap"},te={key:1,class:"text-sm text-red-800"},se={class:"p-4 bg-muted rounded-lg"},ie={class:"grid grid-cols-2 gap-4 text-sm"},ae={class:"font-medium"},le={class:"font-medium"},oe={class:"space-y-2"},ne={key:0,class:"text-sm text-destructive"},de={key:0,class:"space-y-2"},re={class:"space-y-2"},ue={class:"flex items-center gap-2 flex-1"},ce={class:"flex-1 min-w-0"},fe={class:"text-xs text-muted-foreground"},me={class:"space-y-2"},pe={class:"flex items-center gap-2"},ve={key:0,class:"text-sm text-destructive"},_e={key:1,class:"space-y-2"},xe={class:"space-y-2"},ge={class:"flex items-center gap-2 flex-1"},he={class:"flex-1 min-w-0"},ye={class:"text-sm font-medium truncate"},be={class:"text-xs text-muted-foreground"},ke={class:"flex gap-3 pt-4"},Ae=M({__name:"Edit",props:{justification:{},attendance:{}},setup(u){const w=u,x=h(w.justification.description),p=h([]),m=h([]),n=h({}),N=C(()=>w.justification.files.filter(l=>!m.value.includes(l.id))),g=C(()=>N.value.length+p.value.length),P=l=>{const e=l.target;if(e.files){const a=Array.from(e.files);if(g.value+a.length>5){n.value.files="Maximum 5 files allowed (including existing files)";return}for(const v of a){if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(v.type)){n.value.files="Only PDF, JPG, JPEG, and PNG files are allowed";return}if(v.size>10*1024*1024){n.value.files="Each file must be less than 10MB";return}}p.value=[...p.value,...a],n.value.files="",e.value=""}},U=l=>{p.value.splice(l,1)},z=l=>{m.value.push(l)},B=l=>{const e=m.value.indexOf(l);e>-1&&m.value.splice(e,1)},V=()=>{if(n.value={},!x.value.trim()){n.value.description="Description is required";return}if(g.value===0){n.value.files="At least one file is required";return}if(g.value>5){n.value.files="Maximum 5 files allowed";return}const l=new FormData;l.append("_method","PUT"),l.append("description",x.value),p.value.forEach(e=>{l.append("files[]",e)}),m.value.forEach(e=>{l.append("delete_files[]",String(e))}),F.post(`/student/justifications/${w.justification.id}`,l,{onSuccess:()=>{F.visit("/student/justifications")},onError:e=>{console.error("Update errors:",e)}})};return(l,e)=>(r(),j(G,{title:"Edit Justification"},{default:o(()=>[t("div",Y,[t("div",Z,[i(s(J),null,{default:o(()=>[i(s(q),null,{default:o(()=>[i(s(A),null,{default:o(()=>[...e[2]||(e[2]=[c("Edit Justification",-1)])]),_:1}),i(s(T),null,{default:o(()=>[c(" Update your justification for absence on "+d(u.attendance.date)+" - "+d(u.attendance.module),1)]),_:1})]),_:1}),i(s(S),{class:"space-y-6"},{default:o(()=>[t("div",Q,[i(s(H),{class:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),t("div",W,[e[3]||(e[3]=t("h4",{class:"font-semibold text-red-900 mb-1"},"Your justification was rejected",-1)),u.justification.admin_notes?(r(),f("p",ee,d(u.justification.admin_notes),1)):(r(),f("p",te," No reason provided by admin. "))])]),t("div",se,[t("div",ie,[t("div",null,[e[4]||(e[4]=t("p",{class:"text-muted-foreground"},"Module",-1)),t("p",ae,d(u.attendance.module)+" ("+d(u.attendance.module_code)+")",1)]),t("div",null,[e[5]||(e[5]=t("p",{class:"text-muted-foreground"},"Date",-1)),t("p",le,d(u.attendance.date),1)])])]),t("div",oe,[i(s(k),{for:"description"},{default:o(()=>[...e[6]||(e[6]=[c("Description *",-1)])]),_:1}),i(s(I),{id:"description",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),placeholder:"Explain the reason for your absence...",rows:"5",class:b({"border-destructive":n.value.description})},null,8,["modelValue","class"]),n.value.description?(r(),f("p",ne,d(n.value.description),1)):y("",!0)]),u.justification.files.length>0?(r(),f("div",de,[i(s(k),null,{default:o(()=>[...e[7]||(e[7]=[c("Current Files",-1)])]),_:1}),t("div",re,[(r(!0),f($,null,D(u.justification.files,a=>(r(),f("div",{key:a.id,class:b(["flex items-center justify-between p-3 border rounded-lg",m.value.includes(a.id)?"bg-red-50 border-red-200":"bg-muted"])},[t("div",ue,[i(s(X),{class:"h-4 w-4 text-muted-foreground"}),t("div",ce,[t("p",{class:b(["text-sm font-medium truncate",m.value.includes(a.id)?"line-through text-muted-foreground":""])},d(a.file_name),3),t("p",fe,d(a.file_type.toUpperCase())+" â€¢ "+d(a.file_size)+" KB ",1)])]),m.value.includes(a.id)?(r(),j(s(_),{key:1,variant:"ghost",size:"sm",onClick:v=>B(a.id),class:"text-green-600 hover:text-green-600"},{default:o(()=>[...e[8]||(e[8]=[c(" Undo ",-1)])]),_:1},8,["onClick"])):(r(),j(s(_),{key:0,variant:"ghost",size:"sm",onClick:v=>z(a.id),class:"text-destructive hover:text-destructive"},{default:o(()=>[i(s(E),{class:"h-4 w-4"})]),_:1},8,["onClick"]))],2))),128))])])):y("",!0),t("div",me,[i(s(k),{for:"files"},{default:o(()=>[...e[9]||(e[9]=[c("Add New Files",-1)])]),_:1}),t("div",pe,[i(s(L),{id:"files",type:"file",multiple:"",accept:".pdf,.jpg,.jpeg,.png",onChange:P,class:b({"border-destructive":n.value.files})},null,8,["class"]),i(s(O),{variant:"secondary"},{default:o(()=>[c(d(g.value)+"/5",1)]),_:1})]),e[10]||(e[10]=t("p",{class:"text-sm text-muted-foreground"}," PDF, JPG, JPEG, PNG (max 10MB each) ",-1)),n.value.files?(r(),f("p",ve,d(n.value.files),1)):y("",!0)]),p.value.length>0?(r(),f("div",_e,[i(s(k),null,{default:o(()=>[...e[11]||(e[11]=[c("New Files to Upload",-1)])]),_:1}),t("div",xe,[(r(!0),f($,null,D(p.value,(a,v)=>(r(),f("div",{key:v,class:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg"},[t("div",ge,[i(s(R),{class:"h-4 w-4 text-green-600"}),t("div",he,[t("p",ye,d(a.name),1),t("p",be,d((a.size/1024).toFixed(2))+" KB ",1)])]),i(s(_),{variant:"ghost",size:"sm",onClick:we=>U(v),class:"text-destructive hover:text-destructive"},{default:o(()=>[i(s(E),{class:"h-4 w-4"})]),_:1},8,["onClick"])]))),128))])])):y("",!0),t("div",ke,[i(s(_),{onClick:V,class:"flex-1"},{default:o(()=>[...e[12]||(e[12]=[c(" Update & Resubmit ",-1)])]),_:1}),i(s(_),{variant:"outline",onClick:e[1]||(e[1]=a=>s(F).visit("/student/justifications"))},{default:o(()=>[...e[13]||(e[13]=[c(" Cancel ",-1)])]),_:1})])]),_:1})]),_:1})])])]),_:1}))}});export{Ae as default};
